--- START OF FILE index.html ---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>agraj - Portfolio</title>
    <link rel="icon" type="image/png" href="frieren.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhai+2:wght@700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/framer-motion/10.12.16/framer-motion.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind Config
        window.tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark': '#0f0a19',
                        'darker': '#090613',
                        'accent': '#9272CE',
                        'accent-hover': '#AE8BD5',
                        'light-accent': '#CBB8E8',
                        'text-primary': '#ffffff',
                        'text-secondary': '#D1D1D1',
                        'text-tertiary': '#A8A8A8',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Baloo Bhai 2', 'cursive'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Base Styles */
        body {
            background-color: #0f0a19;
            color: #D1D1D1;
            font-family: 'Inter', sans-serif; /* Default font */
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Background with particle effect */
        .bg-particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10;
            overflow: hidden;
        }

        .bg-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 30%, rgba(146, 114, 206, 0.06), rgba(15, 10, 25, 0.98) 70%);
            z-index: -5;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            font-weight: 700; /* Default bold for headings */
            font-family: 'Inter', sans-serif; /* Default heading font */
        }

        /* Apply Baloo Bhai 2 only where font-serif class is used */
        .font-serif {
             font-family: 'Baloo Bhai 2', cursive;
        }

        .gradient-text {
            background: linear-gradient(90deg, #FFFFFF, #CBB8E8, #9272CE, #CBB8E8, #FFFFFF);
            background-size: 300% auto;
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            animation: gradient 8s linear infinite;
            display: inline-block; /* Helps with background clipping */
        }

        /* Animated cursor */
        .typed-cursor {
            display: inline-block;
            width: 2px;
            height: 1.1em; /* Adjusted height */
            background-color: #9272CE;
            margin-left: 4px;
            animation: pulse 1s infinite;
            vertical-align: text-bottom; /* Align cursor better */
        }
        /* Adjust cursor height specifically for h1 */
        h1 .typed-cursor {
             height: 1em;
             /* Ensure cursor color is visible even with gradient text */
             background-color: #CBB8E8; /* Match a lighter color from gradient */
             mix-blend-mode: normal; /* Prevent blending issues */
             opacity: 0.8;
        }
        /* Adjust cursor color for blockquote */
        blockquote .typed-cursor {
             background-color: #A8A8A8; /* Match text-tertiary */
        }


        /* Card Hover Effects */
        .card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: rgba(15, 10, 25, 0.7);
            border: 1px solid rgba(146, 114, 206, 0.15);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent,
                rgba(146, 114, 206, 0.1),
                transparent);
            transform: translateX(-100%);
            transition: transform 0.8s ease;
            pointer-events: none;
        }

        .card:hover {
            box-shadow: 0 15px 30px rgba(9, 6, 19, 0.5), 0 0 15px rgba(146, 114, 206, 0.3);
            border-color: rgba(146, 114, 206, 0.4);
        }

        .card:hover::before {
            transform: translateX(100%);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(9, 6, 19, 0.8);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(146, 114, 206, 0.5);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(146, 114, 206, 0.7);
        }

        /* Hover Link Effect */
        .hover-link {
            position: relative;
            display: inline-block;
        }

        .hover-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 1px;
            background-color: #9272CE;
            transition: width 0.3s ease;
        }

        .hover-link:hover::after {
            width: 100%;
        }

        /* Quote Block */
        .quote {
            position: relative;
            border-left: 3px solid #9272CE;
        }

        .quote::before {
            content: '"';
            position: absolute;
            top: -20px;
            left: 10px;
            font-size: 5rem;
            color: rgba(146, 114, 206, 0.1);
            font-family: 'Inter', sans-serif;
            font-weight: 700;
        }

        /* Reading progress bar */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            z-index: 100;
        }

        .progress-bar {
            height: 3px;
            background: linear-gradient(90deg, #9272CE, #AE8BD5);
            width: 0%;
        }

        /* Static Image Style */
        .static-image-container {
            display: block;
            margin: 2.5rem auto 0 auto; /* mt-10 mx-auto */
            width: fit-content;
            opacity: 0.8;
            transition: opacity 0.3s ease;
            z-index: 5;
        }

        .static-image {
             width: 8rem; /* 128px */
             height: 8rem;
             cursor: pointer;
             transition: transform 0.3s ease;
        }
        .static-image:hover {
            transform: scale(1.1);
        }

        /* Minimum height for rotating text containers to prevent layout shifts */
        #typewriter { min-height: 3em; display: inline-block; width: 100%; } /* Ensure it takes width */
        #main-heading-text { min-height: 1.2em; display: inline-block; } /* inline-block needed for height */
        #blockquote-text { min-height: 4em; display: inline-block; } /* inline-block needed for height */


        /* Additional utility classes */
        .text-accent { color: #9272CE; }
        .hover\:text-accent-hover:hover { color: #AE8BD5; }
        .bg-accent { background-color: #9272CE; }
        .hover\:bg-accent-hover:hover { background-color: #AE8BD5; }
        .text-text-primary { color: #ffffff; }
    </style>
</head>
<body>
    <!-- Reading Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Background Particles -->
    <div class="bg-particle-container" id="particles"></div>
    <div class="bg-overlay"></div>

    <!-- Header -->
    <header class="fixed top-0 left-0 w-full bg-darker/80 backdrop-blur-md z-50 border-b border-accent/10">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <!-- Name Updated - Using font-serif for Baloo Bhai 2 -->
                <a href="index.html" class="text-2xl lg:text-3xl font-bold text-text-primary hover:text-accent transition-colors duration-300 font-serif">
                    a-g-r-a-j {/* Static part */}
                </a>

                <!-- Mobile Menu Button -->
                <button id="menuButton" class="md:hidden text-text-primary focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                    </svg>
                </button>

                <!-- Desktop Navigation -->
                <nav class="hidden md:flex space-x-8 text-text-primary">
                    <a href="https://www.blogger.com/profile/06675668817383737660" target="_blank" rel="noopener noreferrer" class="hover-link hover:text-accent transition-colors">About Me</a>
                    <a href="https://www.reddit.com/user/Federal_Anywhere_559/" target="_blank" rel="noopener noreferrer" class="hover-link hover:text-accent transition-colors">Contact Me</a>
                    <a href="writings.html" class="hover-link hover:text-accent transition-colors">Writings</a>
                </nav>
            </div>

            <!-- Mobile Menu -->
            <div id="mobileMenu" class="hidden md:hidden mt-4 py-4 border-t border-accent/10 animate-in">
                <nav class="flex flex-col space-y-4">
                    <a href="https://www.blogger.com/profile/06675668817383737660" target="_blank" rel="noopener noreferrer" class="hover:text-accent transition-colors py-2 px-4 hover:bg-accent/10 rounded">About Me</a>
                    <a href="https://www.reddit.com/user/Federal_Anywhere_559/" target="_blank" rel="noopener noreferrer" class="hover:text-accent transition-colors py-2 px-4 hover:bg-accent/10 rounded">Contact Me</a>
                    <a href="writings.html" class="hover:text-accent transition-colors py-2 px-4 hover:bg-accent/10 rounded">Writings</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-6 pt-32 pb-16">
        <!-- Hero Section -->
        <section class="text-center mb-20 opacity-0" id="heroSection">
            <!-- Main Heading with rotating text span - Initially empty -->
            <h1 class="gradient-text text-5xl md:text-6xl lg:text-7xl font-bold mb-6 tracking-tight font-serif">
                <span id="main-heading-text"></span>{/* Empty */}
            </h1>
            <!-- Tagline/Quote Element - Initially empty -->
            <p class="text-xl md:text-2xl text-text-secondary mb-12 italic" id="typewriter">
                {/* Empty */}
            </p>
            <!-- Blockquote with rotating text span - Initially empty -->
            <blockquote class="quote max-w-3xl mx-auto text-lg md:text-xl bg-darker/70 backdrop-blur-sm p-6 rounded-lg shadow-xl text-text-tertiary border-l-4 border-accent">
                "<span id="blockquote-text"></span>"{/* Empty */}
            </blockquote>
        </section>

        <!-- Recent Writings Section -->
        <section class="mb-16 opacity-0" id="writingsSection">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-text-primary mb-12">Recent Writings</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Card 1 -->
                <div class="card rounded-lg p-7 shadow-lg relative overflow-hidden" data-delay="0">
                    <h3 class="text-xl lg:text-2xl font-semibold text-text-primary mb-4 group">
                        <span class="hover:text-accent transition-all duration-300 inline-block">So, you want to travel back</span>
                    </h3>
                    <div class="mb-5">
                        <p class="text-text-secondary line-clamp-3">"So, you want to travel back, for you could not contain, could not refrain, that boundless hunger deep within, For all the changes you could pinch..."</p>
                    </div>
                    <a href="writings.html#post-2137542659647715265" class="text-accent hover:text-accent-hover font-medium inline-flex items-center hover-link">
                        Read More
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                    </a>
                </div>

                <!-- Card 2 -->
                <div class="card rounded-lg p-7 shadow-lg relative overflow-hidden" data-delay="150">
                    <h3 class="text-xl lg:text-2xl font-semibold text-text-primary mb-4 group">
                        <span class="hover:text-accent transition-all duration-300 inline-block">The Cost of Belonging</span>
                    </h3>
                    <div class="mb-5">
                        <p class="text-text-secondary line-clamp-3">Was I born different? What did I do different that made me the way I am? These are some of the questions that rebels like myself ask themselves at some point in life...</p>
                    </div>
                    <a href="writings.html#post-3486396209614590705" class="text-accent hover:text-accent-hover font-medium inline-flex items-center hover-link">
                        Read More
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                    </a>
                </div>

                <!-- Card 3 -->
                <div class="card rounded-lg p-7 shadow-lg relative overflow-hidden" data-delay="300">
                    <h3 class="text-xl lg:text-2xl font-semibold text-text-primary mb-4 group">
                        <span class="hover:text-accent transition-all duration-300 inline-block">[POST] A New Chapter</span>
                    </h3>
                    <div class="mb-5">
                        <p class="text-text-secondary line-clamp-3">It's been so long that we have written anything and so much has happened and I don't mean to provide like a storytelling effect or something but really so much has happened...</p>
                    </div>
                    <a href="writings.html#post-8246180062320707624" class="text-accent hover:text-accent-hover font-medium inline-flex items-center hover-link">
                        Read More
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                    </a>
                </div>
            </div>

            <div class="text-center mt-16">
                <a href="writings.html" class="bg-accent hover:bg-accent-hover text-text-primary font-medium py-3 px-8 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-accent/20 inline-block relative overflow-hidden group">
                    <span class="relative z-10">View All Writings</span>
                    <span class="absolute inset-0 bg-white/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></span>
                </a>
            </div>

            <!-- Static Image Container -->
            <div id="staticImageContainer" class="static-image-container">
                <img src="FrierenRing.png" alt="Ring Image" id="staticImage" class="static-image">
            </div>

        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gradient-to-t from-darker to-dark/50 border-t border-accent/10 py-8 mt-16">
        <div class="container mx-auto px-6 text-center">
            <p class="text-text-tertiary">© <span id="currentYear"></span> agraj. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // --- Configuration ---
        const ROTATING_TEXT_CONFIG = {
            // Target Element ID -> Settings
            'typewriter': {
                texts: [
                    "Cause no one listens, so I write instead 😎",
                    "Don't forget the ring at the bottom",
                    "There is a chance for a rick roll",
                    "who knows how many videos you can find🤔",
                    "Who knows how much has left to read (^///^)",
                    "Just fragments of thoughts...",
                    "Maybe this is all just a simulation?",
                    "Error 404: Deep meaning not found.",
                    "Probably contemplating existential dread.",
                    "Fueled by caffeine and curiosity.",
                    "Is this the real life? Is this just fantasy?",
                    "Coding, writing, overthinking.",
                    "My therapist told me to write it down."
                ],
                typeSpeed: 80,
                deleteSpeed: 50,
                pauseDuration: 3000
            },
            'main-heading-text': {
                texts: [ // Simplified list
                    "agraj",
                    "a-g-r-a-j"
                ],
                typeSpeed: 100,
                deleteSpeed: 60,
                pauseDuration: 2500
            },
            'blockquote-text': {
                texts: [
                    "If determinism holds, there's a chance I exit early—something dramatic. So I leave fragments of myself here—at least the algorithm remembers me better than my family will😒",
                    "Is free will an illusion, or is the illusion the only free will we have?",
                    "Perhaps the 'fragments' are the only coherent parts left.",
                    "What if the algorithm forgets too?",
                    "Maybe exiting early isn't dramatic, just... efficient.",
                    "Family remembers differently. Algorithms remember precisely. Which is better?",
                    "The universe is indifferent, but the code persists. For now.",
                    "Do androids dream of electric sheep? Do algorithms dream of better data?",
                    "To be, or not to be, that is the computation.",
                    "Cogito, ergo sum... I think, therefore I am... coded?"
                ],
                typeSpeed: 70,
                deleteSpeed: 40,
                pauseDuration: 4500 // Longer pause for longer text
            }
        };

        // --- Reusable Rotating Text Logic ---
        function setupRotatingText(elementId, config) {
            const element = document.getElementById(elementId);
            if (!element) {
                console.error(`Rotating text target element with ID "${elementId}" not found.`);
                return;
            }

            let currentIndex = -1;
            let isBusy = false;
            let cycleTimeout = null;
            let intersectionObserver = null;
            let isVisible = false; // Track visibility state

            // Ensure element is empty initially
            element.textContent = '';

            function typeWriterInternal(text, callback) {
                let i = 0;
                // element.textContent = ''; // Clear previous content - Removed, clearing happens before calling this now
                isBusy = true;

                function type() {
                    if (!isVisible || !isBusy) {
                        isBusy = false;
                        // Clear potentially incomplete text if stopped
                        if (!isVisible) element.textContent = '';
                        return;
                    }
                    if (i < text.length) {
                        element.textContent += text.charAt(i);
                        i++;
                        setTimeout(type, config.typeSpeed);
                    } else {
                        const cursor = document.createElement('span');
                        cursor.className = 'typed-cursor';
                        element.appendChild(cursor);
                        isBusy = false;
                        if (callback) callback();
                    }
                }
                type();
            }

            function deleteWriterInternal(callback) {
                let text = element.textContent;
                const existingCursor = element.querySelector('.typed-cursor');
                if (existingCursor) element.removeChild(existingCursor);
                text = element.textContent;

                let i = text.length;
                isBusy = true;

                function del() {
                    if (!isVisible || !isBusy) {
                        isBusy = false;
                         // Clear potentially incomplete text if stopped
                        if (!isVisible) element.textContent = '';
                        return;
                    }
                    if (i > 0) {
                        element.textContent = text.substring(0, i - 1);
                        i--;
                        if (!element.querySelector('.typed-cursor')) {
                            const cursor = document.createElement('span');
                            cursor.className = 'typed-cursor';
                            element.appendChild(cursor);
                        }
                        setTimeout(del, config.deleteSpeed);
                    } else {
                         const finalCursor = element.querySelector('.typed-cursor');
                         if (finalCursor) element.removeChild(finalCursor);
                         element.textContent = ''; // Ensure fully empty
                        isBusy = false;
                        if (callback) callback();
                    }
                }
                del();
            }

            function scheduleCycle(delay) {
                 clearTimeout(cycleTimeout);
                 cycleTimeout = setTimeout(() => {
                     if(isVisible) {
                         startCycle();
                     }
                 }, delay);
            }

            function startCycle() {
                if (isBusy || !isVisible) {
                    return;
                }

                deleteWriterInternal(() => {
                    if (!isVisible) return; // Check again after delete

                    let nextIndex;
                    do {
                        nextIndex = Math.floor(Math.random() * config.texts.length);
                    } while (nextIndex === currentIndex && config.texts.length > 1);

                    currentIndex = nextIndex;
                    const nextText = config.texts[currentIndex];

                    // Clear element content *before* typing the new text
                    element.textContent = '';
                    typeWriterInternal(nextText, () => {
                        scheduleCycle(config.pauseDuration);
                    });
                });
            }

            // Intersection Observer Logic
            let initialized = false;
            intersectionObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const wasVisible = isVisible;
                    isVisible = entry.isIntersecting;

                    if (isVisible && !wasVisible) { // Became visible
                        if (!initialized) {
                            initialized = true;
                            // Start the very first cycle immediately
                            let firstIndex = Math.floor(Math.random() * config.texts.length);
                            currentIndex = firstIndex;
                            const firstText = config.texts[firstIndex];
                            // Clear content before first type
                            element.textContent = '';
                            typeWriterInternal(firstText, () => {
                                scheduleCycle(config.pauseDuration);
                            });
                        } else {
                            // Resume cycling if it was paused and not currently busy
                            if (!isBusy) {
                                // Restart the cycle cleanly
                                element.textContent = ''; // Clear content before resuming
                                scheduleCycle(100); // Start next cycle quickly
                            }
                        }
                    } else if (!isVisible && wasVisible) { // Became hidden
                        clearTimeout(cycleTimeout);
                        isBusy = false;
                        // Clear content when hidden
                        element.textContent = '';
                    }
                });
            }, { threshold: 0.1 }); // Trigger when 10% visible

            intersectionObserver.observe(element);
        }


        // --- Initializations ---
        document.addEventListener('DOMContentLoaded', () => {
            // Setup rotating text for all configured elements
            for (const elementId in ROTATING_TEXT_CONFIG) {
                setupRotatingText(elementId, ROTATING_TEXT_CONFIG[elementId]);
            }

            // Initialize other features
            setupStaticImageClick();
            initParticles();
            setupMobileMenu();
            setupScrollProgressBar();
            setupCardHoverEffects();
            setupScrollAnimations();
        });

        // --- Other Setup Functions (Consolidated & Refactored) ---

        function setupMobileMenu() {
            const menuButton = document.getElementById('menuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            if (menuButton && mobileMenu) {
                menuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
            const currentYearEl = document.getElementById('currentYear');
            if(currentYearEl) currentYearEl.textContent = new Date().getFullYear();
        }

        function setupScrollProgressBar() {
            const progressBar = document.getElementById("progressBar");
            if (!progressBar) return;
            window.addEventListener('scroll', () => {
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = height > 0 ? (winScroll / height) * 100 : 0;
                progressBar.style.width = scrolled + "%";
            }, { passive: true });
        }

        function setupStaticImageClick() {
            const imageElement = document.getElementById('staticImage');
            if (!imageElement) return;
            const videoUrls = [
                'https://www.youtube.com/watch?v=dQw4w9WgXcQ', 'https://www.youtube.com/watch?v=-jGBp5HBLFs',
                'https://www.youtube.com/shorts/2Dv2hO3rYVg', 'https://www.youtube.com/watch?v=x6YcdgB9e48',
                'https://www.youtube.com/shorts/D-kkjR0NyGg', 'https://www.youtube.com/shorts/LFsS-9lT0Rk',
                'https://www.youtube.com/shorts/TTU1g8IU22I'
            ];
            imageElement.addEventListener('click', () => {
                const randomIndex = Math.floor(Math.random() * videoUrls.length);
                window.open(videoUrls[randomIndex], '_blank');
            });
        }

        function initParticles() {
            try {
                const container = document.getElementById('particles');
                if (!container || typeof THREE === 'undefined') return;

                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x000000, 0);
                container.appendChild(renderer.domElement);

                const particlesGeometry = new THREE.BufferGeometry();
                const particleCount = 750;
                const positions = new Float32Array(particleCount * 3);
                const colors = new Float32Array(particleCount * 3);

                for (let i = 0; i < particleCount * 3; i += 3) {
                    positions[i] = (Math.random() - 0.5) * 20;
                    positions[i+1] = (Math.random() - 0.5) * 20;
                    positions[i+2] = (Math.random() - 0.5) * 20 - 10;
                    colors[i] = Math.random() * 0.5 + 0.5;
                    colors[i+1] = Math.random() * 0.3 + 0.2;
                    colors[i+2] = Math.random() * 0.5 + 0.5;
                }
                particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
                const particlesMaterial = new THREE.PointsMaterial({ size: 0.035, vertexColors: true, transparent: true, opacity: 0.75 });
                const particleSystem = new THREE.Points(particlesGeometry, particlesMaterial);
                scene.add(particleSystem);
                camera.position.z = 5;

                let mouseX = 0, mouseY = 0;
                const onMouseMove = (event) => {
                    mouseX = (event.clientX / window.innerWidth) * 2 - 1;
                    mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
                };
                document.addEventListener('mousemove', onMouseMove, { passive: true });

                let animationFrameId = null;
                function animate() {
                    animationFrameId = requestAnimationFrame(animate);
                    particleSystem.rotation.x += 0.0005 + mouseY * 0.0005;
                    particleSystem.rotation.y += 0.0005 + mouseX * 0.0005;
                    renderer.render(scene, camera);
                }
                animate();

                const onResize = () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                };
                window.addEventListener('resize', onResize);

                window.addEventListener('unload', () => {
                    cancelAnimationFrame(animationFrameId);
                    document.removeEventListener('mousemove', onMouseMove);
                    window.removeEventListener('resize', onResize);
                });

            } catch (error) { console.error("Error initializing particles:", error); }
        }

        function setupCardHoverEffects() {
            document.querySelectorAll('.card').forEach(card => {
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left; const y = e.clientY - rect.top;
                    const centerX = rect.width / 2; const centerY = rect.height / 2;
                    const rotateX = (y - centerY) / 20; const rotateY = (centerX - x) / 20;
                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateZ(20px)`;
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0px)';
                });
                card.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', (e) => e.stopPropagation());
                });
            });
        }

        function setupScrollAnimations() {
             const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -30px 0px'
            };

            const observer = new IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                    // Check if the element is one of the rotating text spans
                    const isRotatingText = Object.keys(ROTATING_TEXT_CONFIG).includes(entry.target.id);

                    if (entry.isIntersecting) {
                        // Only apply fade/transform animation if NOT a rotating text element
                        if (!isRotatingText) {
                            entry.target.style.opacity = '1';
                            entry.target.style.transform = entry.target.dataset.initialTransform || 'translateY(0)';
                            obs.unobserve(entry.target); // Unobserve after animation
                        }
                    }
                    // No 'else' needed here, visibility for rotating text is handled by its own observer
                });
            }, observerOptions);

            // Observe Hero Section (simple fade/translate) - It contains rotating text, so observe children if needed, or just let rotating text handle itself
             const heroSection = document.getElementById('heroSection');
             if (heroSection) {
                 // Apply initial styles for the overall section fade-in
                 heroSection.style.opacity = '0';
                 heroSection.style.transform = 'translateY(20px)';
                 heroSection.dataset.initialTransform = 'translateY(0)';
                 heroSection.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out';
                 observer.observe(heroSection);
                 // Note: The rotating text elements inside will handle their own visibility via their specific observers.
             }


            // Observe Writings Section (simple fade/translate)
            const writingsSection = document.getElementById('writingsSection');
             if (writingsSection) {
                writingsSection.style.opacity = '0';
                writingsSection.style.transform = 'translateY(20px)';
                writingsSection.dataset.initialTransform = 'translateY(0)';
                writingsSection.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out';
                observer.observe(writingsSection);
            }

            // Observe Cards (more complex transform)
            document.querySelectorAll('.card').forEach(card => {
                const delay = parseInt(card.getAttribute('data-delay')) || 0;
                card.style.opacity = '0';
                card.style.transform = 'perspective(1000px) rotateX(10deg) rotateY(10deg) translateZ(-20px)';
                card.dataset.initialTransform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0px)';
                card.style.transition = `opacity 0.8s ease-out ${delay}ms, transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) ${delay}ms`;
                observer.observe(card);
            });
        }

    </script>
</body>
</html>
